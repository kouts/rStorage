JSON.unflatten=function(e){if(Object(e)!==e||Array.isArray(e)||Object.getOwnPropertyNames(e).length===0){return e}var b={},g,h,a,d,c;for(var f in e){g=b,h="",d=0;do{a=f.indexOf(".",d);c=f.substring(d,a!==-1?a:undefined);g=g[h]||(g[h]=(!isNaN(parseInt(c))?[]:{}));h=c;d=a+1}while(a>=0);g[h]=e[f]}return b[""]};JSON.flatten=function(c){var a={};function b(h,j){if(Object(h)!==h){a[j]=h}else{if(Array.isArray(h)){for(var e=0,d=h.length;e<d;e++){b(h[e],j?j+"."+e:""+e)}if(d==0){a[j]=[]}}else{var g=true;for(var f in h){g=false;b(h[f],j?j+"."+f:f)}if(g){a[j]={}}}}}b(c,"");return a};(function(b){function d(e){return{_merge:function(g,f){if(typeof(g)!="object"){return f}b.each(f,function(h){g[h]=f[h]});return g},_getNamespace:function(f){if(f.search(/\./)==-1){return f}return f.substr(0,f.indexOf("."))},_getKey:function(f){if(f.search(/\./)==-1){return null}return f.substr(f.indexOf(".")+1)},get:function(l){var i=this._getNamespace(l);l=this._getKey(l);if(!l){return JSON.parse(e.getItem(i))}else{var h=e.getItem(i);if(h){h=JSON.flatten(JSON.parse(h));if(h[l]===undefined){var g={},f;b.each(h,function(j,k){if(j.indexOf(".")!=-1&&j.search(l)!=-1){f=j.replace(l+".","");g[f]=k}});h=f?g:null}else{h=h[l]}return JSON.unflatten(h)}else{return null}}},_save:function(m,h){var i=this._getNamespace(m);m=this._getKey(m);var g=e.getItem(i);if(g){g=JSON.flatten(JSON.parse(g));var l=g;var k=false;b.each(g,function(j){if(j==m){l[m]=h;k=true}});if(!k){if(m){var f={};f[m]=h;f=JSON.flatten(f);l=this._merge(l,f)}else{l=h}}h=JSON.unflatten(l)}else{if(m){var f={};f[m]=h;h=f}}e.setItem(i,JSON.stringify(h));return h},remove:function(i){var h=this._getNamespace(i);i=this._getKey(i);if(i){var g=e.getItem(h);if(g){g=JSON.flatten(JSON.parse(g));if(g[i]){delete g[i]}else{var f=g;b.each(f,function(j){if(j.search(i)!=-1){delete g[j]}})}g=JSON.unflatten(g)}this._save(h,g)}else{e.removeItem(h)}return this.get(h)},set:function(h,g){if(typeof(g)=="object"){var f=this.get(h);if(f){g=this._merge(f,g)}}return this._save(h,g)}}}var c=new d(sessionStorage);b.sessionStorage=function(e,f){if(typeof(f)==="undefined"){return c.get(e)}else{return c.set(e,f)}};b.sessionStorage.remove=function(e){return c.remove(e)};var a=new d(localStorage);b.localStorage=function(e,f){if(typeof(f)==="undefined"){return a.get(e)}else{return a.set(e,f)}};b.localStorage.remove=function(e){return a.remove(e)}}(jQuery));